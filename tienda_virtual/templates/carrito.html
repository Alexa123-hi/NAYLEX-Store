{% extends 'base.html' %}
{% block title %}Carrito de compras{% endblock %}
{% block content %}
<div class="container mt-5 mb-5">
  <h2 class="text-center mb-4 page-title">ğŸ›’Carrito de Compras</h2>
  {% if productos %}
    <table class="table table-bordered-nx">
      <thead>
        <tr>
          <th>ğŸ”©Producto</th><th>ğŸ¤µğŸ¼Proveedor</th><th>#ï¸âƒ£Cantidad</th><th>ğŸª™Precio Unitario</th>
          <th>ğŸ’¹IVA (%)</th><th>ğŸ’¸IVA Valor</th><th>ğŸ’¶Subtotal</th><th>ğŸ‘†ğŸ¼Acciones</th>
        </tr>
      </thead>
      <tbody>
      {% for item in productos %}
        <tr>
          <td>{{ item.producto.nombre }}</td>
          <td>{{ item.proveedor.id_proveedor }}</td>
          <td>{{ item.cantidad }}</td>
          <td>${{ "{:,.0f}".format(item.precio) }}</td>
          <td>{{ item.iva }}%</td>
          <td>${{ "{:,.0f}".format(item.iva_valor) }}</td>
          <td>${{ "{:,.0f}".format(item.subtotal) }}</td>
          <td>
            <form action="{{ url_for('carrito_compras_bp.restar_unidad_carrito', key=item.key) }}" method="post" style="display:inline;">
              <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-outline-warning" type="submit" title="Eliminar una unidad">âˆ’</button>
            </form>
            <form action="{{ url_for('carrito_compras_bp.eliminar_del_carrito', key=item.key) }}" method="post" style="display:inline;" data-confirm="Â¿Estas seguro de eliminar todas las unidades de este producto del carrito?">
              <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
              <button class="btn btn-outline-danger" type="submit">âœ‚ï¸Eliminar</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="d-flex justify-content-between align-items-center mt-4">
      <div>
        <span class="total-bordered">
          <strong>
            ğŸ’¶Subtotal: ${{ "{:,.0f}".format(total_sin_iva) }}<br>
            ğŸ’¹IVA (19%): ${{ "{:,.0f}".format(total_iva) }}<br>
            ğŸ’°Total: ${{ "{:,.0f}".format(total) }}
          </strong>
        </span>
        <a href="{{ url_for('compras_bp.compra') }}" class="btn btn-outline-success">ğŸ›ï¸Comprar</a>
      </div>
      <div>
        <a href="{{ url_for('productos_bp.productos') }}" class="btn btn-outline-primary">â†©ï¸Volver al catÃ¡logo</a>
        <form action="{{ url_for('carrito_compras_bp.vaciar_carrito') }}" method="post" style="display:inline;" data-confirm="Â¿Seguro que quieres vaciar el carrito?">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-warning ms-2" type="submit">ğŸ—‘ï¸Vaciar carrito</button>
        </form>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info text-center">ğŸ“­Tu carrito estÃ¡ vacÃ­o.</div>
    <div class="text-center">
      <a href="{{ url_for('productos_bp.productos') }}" class="btn btn-outline-primary">â†©ï¸Volver al catÃ¡logo</a>
    </div>
  {% endif %}
</div>
{% endblock %}
