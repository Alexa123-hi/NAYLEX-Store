{% extends 'base.html' %}
{% block title %}Productos{% endblock %}
{% block content %}
<div class="container mt-5 mb-5">
  <h2 class="text-center mb-4 page-title">游닀Cat치logo de Productos</h2>
  <div class="row d-flex flex-wrap">
    <form method="GET" action="{{ url_for('productos_bp.productos') }}" class="search-bar mb-3">
      <span class="search-icon">游댌</span>
      <input type="text" name="filtro" id="buscador" class="search-input" placeholder="游뱂Buscar producto por nombre, c칩digo, proveedor..." value="{{ filtro|default('') }}">
      <button type="submit" class="hidden"></button>
    </form>

    {% for item in productos %}
    <div class="col-md-6 col-lg-4 d-flex">
      <div class="product-card w-100">
        <div>
          <div class="product-title">{{ item.producto.nombre }}</div>
          <div class="product-code"><b>C칩digo:</b> {{ item.producto.codigo }}</div>
          <div class="product-description"><b>Descripci칩n:</b> {{ item.producto.descripcion }}</div>
          <div class="product-state"><b>Estado:</b>
            {% if item.producto.id_estado_producto %}{{ item.producto.estado_producto.estado }}{% else %}<span style="color:#aaa;">No definido</span>{% endif %}
          </div>
          <div><b>Proveedor:</b> {{ item.proveedor.nombre }}</div>
          <div><b>Disponible:</b> {{ item.stock_disponible }}</div>
          <div><b>En carrito:</b> {{ item.en_carrito }}</div>
          <div><b>Precio:</b> ${{ "{:,.0f}".format(item.precio) }}</div>
        </div>
        <form method="POST" action="{{ url_for('carrito_compras_bp.agregar_al_carrito', id_producto=item.producto.id_producto, id_proveedor=item.proveedor.id_proveedor) }}">
          <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-outline-success" {% if item.stock_disponible <= 0 %}disabled{% endif %}>游 Agregar al carrito</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
